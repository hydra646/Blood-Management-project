{% extends 'core/base.html' %}
{% load static %}
{% load i18n %}
{% block body_class %}donor-dashboard-page{% endblock %}
{% block content %}
<div class="row gx-4">
	<div class="col-lg-4">
		<div class="profile-card mb-4 text-center">
			<img src="{% if user.profile_photo %}{{ user.profile_photo.url }}{% else %}{% static 'img/default-avatar.png' %}{% endif %}" alt="avatar" class="profile-avatar mb-2">
			<h5 class="mb-0">{{ user.get_full_name|default:user.username }}</h5>
			<div class="small-muted">{{ user.email }}</div>
			<div class="mt-3 text-start px-2">
				<div><strong>{% trans "Phone" %}:</strong> {{ user.phone|default:'—' }}</div>
				<div><strong>{% trans "City" %}:</strong> {{ user.city|default:'—' }}</div>
				<div><strong>{% trans "Blood Group" %}:</strong> <span class="badge" style="background:#b30000;color:#fff">{{ user.blood_group|default:'—' }}</span></div>
			</div>
			<div class="mt-3 px-3">
				<a class="btn btn-primary w-100 mb-2" href="{% url 'create-request' %}">{% trans "Create Request" %}</a>
				<a class="btn btn-outline-secondary w-100" href="{% url 'profile' %}">{% trans "Edit Profile" %}</a>
			</div>
		</div>
		<div class="card mb-3">
			<div class="card-body">
				<h6 class="mb-2">{% trans "Quick actions" %}</h6>
						<div class="d-flex gap-2 flex-column">
							<a class="btn btn-outline-primary" href="{% url 'search-donors' %}">{% trans "Search Blood Banks" %}</a>
					<a class="btn btn-outline-secondary" href="{% url 'create-request' %}">{% trans "New Request" %}</a>
				</div>
			</div>
		</div>
	</div>

	<div class="col-lg-8">
		<div class="card mb-3">
			<div class="card-body">
				<h4 class="mb-3">{% trans "Donation History" %}</h4>
				<div class="table-responsive shadow-sm rounded">
					<table class="table table-hover mb-0">
						<thead class="table-light"><tr><th>{% trans "Date" %}</th><th>{% trans "Bank" %}</th><th>{% trans "Group" %}</th><th>{% trans "Units" %}</th><th>{% trans "Approved" %}</th></tr></thead>
						<tbody>
							{% for d in donations %}
							<tr>
								<td>{{ d.date|date:"Y-m-d H:i" }}</td>
								<td>{{ d.blood_bank }}</td>
								<td>{{ d.blood_group }}</td>
								<td>{{ d.units }}</td>
								<td>{% if d.approved %}<span class="badge bg-success">{% trans "Yes" %}</span>{% else %}<span class="badge bg-secondary">{% trans "No" %}</span>{% endif %}</td>
							</tr>
							{% empty %}
							<tr><td colspan="5">{% trans "No donations yet." %}</td></tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-md-6">
				<div class="card dashboard-stats p-3 mb-3">
					<div class="card-body">
						<h6>{% trans "Available blood groups (all banks)" %}</h6>
						<ul class="mb-0">
							{% for item in available %}
								<li>{{ item.blood_group }}: {{ item.total }}</li>
							{% endfor %}
						</ul>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="card p-3 mb-3">
					<div class="card-body">
						<h6>{% trans "Your stats" %}</h6>
						<p class="mb-0">{% trans "Total donations:" %} <strong>{{ donations|length }}</strong></p>
					</div>
				</div>
			</div>
		</div>
	</div>

		<div class="card mb-3">
			<div class="card-body">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<h4 class="mb-0">{% trans "Your Requests" %}</h4>
					<a class="btn btn-sm btn-outline-primary" href="{% url 'my-requests' %}">{% trans "View all" %}</a>
				</div>
				<div class="table-responsive">
					<table class="table table-sm">
						<thead><tr><th>{% trans "Date" %}</th><th>{% trans "Group" %}</th><th>{% trans "Units" %}</th><th>{% trans "City" %}</th><th>{% trans "Status" %}</th></tr></thead>
						<tbody>
							{% for r in requests %}
							<tr>
								<td>{{ r.created_at|date:"Y-m-d H:i" }}</td>
								<td>{{ r.blood_group }}</td>
								<td>{{ r.units }}</td>
								<td>{{ r.city }}</td>
								<td>
									{% if r.status == 'pending' %}
										<span class="badge bg-warning text-dark">{% trans "Pending" %}</span>
									{% elif r.status == 'approved' %}
										<span class="badge bg-success">{% trans "Approved" %}</span>
									{% else %}
										<span class="badge bg-danger">{% trans "Rejected" %}</span>
									{% endif %}
								</td>
							</tr>
							{% empty %}
							<tr><td colspan="5">{% trans "No requests yet." %}</td></tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
</div>

{% endblock %}