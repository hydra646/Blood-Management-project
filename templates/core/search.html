{% extends 'core/base.html' %}
{% load i18n %}
{% block body_class %}search-page{% endblock %}
{% block content %}

<div class="search-header-card mb-4">
	<h2 class="mb-0">{% trans "Search Donors" %}</h2>
	<p class="mb-0 text-muted">{% trans "Filter by blood group and city" %}</p>
		<form class="row g-2 mt-3" method="get">
			<div class="col-md-4">
			<select name="blood_group" class="form-select">
				<option value="">--{% trans "Blood Group" %}--</option>
				{% for code,label in blood_groups %}
					<option value="{{ code }}" {% if q_bg == code %}selected{% endif %}>{{ label }}</option>
				{% endfor %}
			</select>
		</div>
			<div class="col-md-4">
			<input class="form-control" name="city" placeholder="{% trans 'City' %}" value="{{ q_city }}">
		</div>
			<div class="col-md-4 d-grid d-md-flex justify-content-md-end">
				<button class="btn btn-search me-2">{% trans "Search" %}</button>
				{% if q_bg or q_city %}
					<a class="btn btn-outline-secondary" href="{% url 'search-donors' %}">{% trans "Clear" %}</a>
				{% endif %}
		</div>
	</form>
</div>

	<div class="card p-3">
		{% if total_count is not None %}
		<div class="d-flex justify-content-between align-items-center mb-2 results-summary">
			<div class="text-muted small">
				{% blocktrans %}Showing {{ start_index }}–{{ end_index }} of {{ total_count }} donors{% endblocktrans %}
			</div>
		</div>
		{% endif %}
	<div class="table-responsive">
			<table class="table table-striped table-hover align-middle mb-0 search-table">
			<thead class="table-light">
				<tr>
					<th>{% trans "Username" %}</th>
					<th>{% trans "Blood Group" %}</th>
					<th>{% trans "City" %}</th>
					<th>{% trans "Contact" %}</th>
				</tr>
			</thead>
			<tbody>
				{% for d in donors %}
				<tr>
					<td>{{ d.username }}</td>
						<td><span class="badge bg-danger">{{ d.blood_group|default:"—" }}</span></td>
					<td>{{ d.city|default:"—" }}</td>
					<td>{{ d.email }}</td>
				</tr>
				{% empty %}
				<tr>
					<td colspan="4" class="text-center py-4 text-muted">{% trans "No donors found." %}</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	{% if is_paginated %}
	<nav class="mt-3" aria-label="Pagination">
		<ul class="pagination justify-content-center">
			<li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
				{% if page_obj.has_previous %}
					<a class="page-link" href="?{% if q_bg %}blood_group={{ q_bg|urlencode }}&{% endif %}{% if q_city %}city={{ q_city|urlencode }}&{% endif %}page={{ page_obj.previous_page_number }}">{% trans "Previous" %}</a>
				{% else %}
					<span class="page-link">{% trans "Previous" %}</span>
				{% endif %}
			</li>

			{% for num in paginator.page_range %}
				<li class="page-item {% if page_obj.number == num %}active{% endif %}">
					{% if page_obj.number == num %}
					<span class="page-link">{{ num }}</span>
					{% else %}
					<a class="page-link" href="?{% if q_bg %}blood_group={{ q_bg|urlencode }}&{% endif %}{% if q_city %}city={{ q_city|urlencode }}&{% endif %}page={{ num }}">{{ num }}</a>
					{% endif %}
				</li>
			{% endfor %}

			<li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
				{% if page_obj.has_next %}
					<a class="page-link" href="?{% if q_bg %}blood_group={{ q_bg|urlencode }}&{% endif %}{% if q_city %}city={{ q_city|urlencode }}&{% endif %}page={{ page_obj.next_page_number }}">{% trans "Next" %}</a>
				{% else %}
					<span class="page-link">{% trans "Next" %}</span>
				{% endif %}
			</li>
		</ul>
	</nav>
	{% endif %}
</div>

{% endblock %}